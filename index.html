<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IFL Playoff Predictor</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
  body {
    font-family: 'Orbitron', sans-serif;
    background: #121212;
    color: #eee;
    margin: 0; padding: 0;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh;
  }
  header {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 1rem 0 2rem 0;
    color: #00ffff;
    text-shadow: 0 0 10px #00ffff;
  }
  .stage {
    width: 95vw;
    max-width: 700px;
    margin-bottom: 3rem;
  }
  h2 {
    border-bottom: 2px solid #00ffff;
    padding-bottom: 0.3rem;
    margin-bottom: 1rem;
  }
  .division-group {
    margin-bottom: 1.5rem;
  }
  .division-title {
    font-size: 1.3rem;
    margin-bottom: 0.7rem;
    color: #00d7ff;
    text-shadow: 0 0 5px #00d7ff;
  }
  .team-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  .team-card {
    background: #222;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    border: 2px solid transparent;
    transition: all 0.2s ease;
    min-width: 140px;
    text-align: center;
  }
  .team-card.selected {
    border-color: #00ffff;
    background: #004d4d;
    color: #00ffff;
    font-weight: 700;
  }
  .team-card.disabled {
    opacity: 0.4;
    pointer-events: none;
  }
  button {
    background: #00ffff;
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    color: #111;
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    box-shadow: 0 0 10px #00ffff;
    transition: background 0.3s ease;
    margin-top: 1rem;
  }
  button:hover:not(:disabled) {
    background: #00d7ff;
  }
  button:disabled {
    background: #005050;
    cursor: not-allowed;
    box-shadow: none;
  }
  /* Horizontal bracket container */
  .bracket-container {
    display: flex;
    flex-direction: row;
    gap: 20px;
    overflow-x: auto;
    padding-bottom: 1rem;
  }
  .round {
    background: #222;
    border-radius: 10px;
    padding: 8px;
    min-width: 180px;
    box-shadow: 0 0 15px #00ffff;
    flex-shrink: 0;
  }
  .round h3 {
    text-align: center;
    margin-bottom: 12px;
    color: #00ffff;
    font-size: 1.1rem;
  }
  .team {
    background: #111;
    margin: 6px 0;
    padding: 6px;
    border-radius: 6px;
    text-align: center;
    font-weight: 700;
    font-size: 0.9rem;
    border: 2px solid transparent;
    white-space: nowrap;
    cursor: pointer;
  }
  .team.selected {
    border-color: #00ffff;
    background: #004d4d;
    color: #00ffff;
  }
  .champion {
    margin-top: 20px;
    font-size: 1.6rem;
    font-weight: 900;
    color: #00ffcc;
    text-shadow: 0 0 20px #00ffcc;
    text-align: center;
  }
  @media (max-width: 480px) {
    .team-card {
      min-width: 100%;
    }
    .round {
      min-width: 90vw;
    }
  }
</style>
</head>
<body>

<header>IFL Playoff Predictor</header>

<div id="stage-1" class="stage">
  <h2>Stage 1: Pick Division Winners (1 per division)</h2>
  <div class="division-group" id="world-east">
    <div class="division-title">World East Division</div>
    <div class="team-list"></div>
  </div>
  <div class="division-group" id="world-central">
    <div class="division-title">World Central Division</div>
    <div class="team-list"></div>
  </div>
  <div class="division-group" id="world-west">
    <div class="division-title">World West Division</div>
    <div class="team-list"></div>
  </div>
  <button id="to-stage-2" disabled>Next: Select Wildcards</button>
</div>

<div id="stage-2" class="stage" style="display:none;">
  <h2>Stage 2: Pick 5 Wildcard Teams</h2>
  <div class="team-list" id="wildcard-list"></div>
  <button id="to-stage-3" disabled>Next: Build Bracket</button>
</div>

<div id="stage-3" class="stage" style="display:none;">
  <h2>Stage 3: Playoff Bracket</h2>
  <div class="bracket-container" id="quarterfinals"></div>
  <div class="bracket-container" id="semifinals" style="display:none;"></div>
  <div class="bracket-container" id="final" style="display:none;"></div>
  <div class="champion" id="champion" style="display:none;"></div>
  <button id="generate-bracket" style="display:none;">Generate Bracket</button>
</div>

<script>
  const divisions = {
    "World East Division": [
      "Australia Whites",
      "Italia Bulls",
      "Belarus Barbarians",
      "Singapore Smelters",
      "South Korea Deers",
      "Poland Panthers"
    ],
    "World Central Division": [
      "Germany Cavaliers",
      "UK 3 Lions",
      "Finaland Frigate",
      "Belgium Bulldogs",
      "Holland Hornets",
      "South Africa Silverbacks"
    ],
    "World West Division": [
      "USA Drones",
      "Jamaica Thunder",
      "Rwanda Raiders",
      "Egypt Pharaohs",
      "Peru Piranhas",
      "Brazil Hummingbirds"
    ]
  };

  let divisionWinners = {};
  let wildcardTeams = [];
  let quarterFinalWinners = [null, null, null, null];
  let semiFinalWinners = [null, null];
  let finalWinner = null;

  // Stage 1 Elements
  const stage1 = document.getElementById("stage-1");
  const toStage2Btn = document.getElementById("to-stage-2");

  // Stage 2 Elements
  const stage2 = document.getElementById("stage-2");
  const wildcardList = document.getElementById("wildcard-list");
  const toStage3Btn = document.getElementById("to-stage-3");

  // Stage 3 Elements
  const stage3 = document.getElementById("stage-3");
  const quarterfinalsDiv = document.getElementById("quarterfinals");
  const semifinalsDiv = document.getElementById("semifinals");
  const finalDiv = document.getElementById("final");
  const championDiv = document.getElementById("champion");
  const generateBracketBtn = document.getElementById("generate-bracket");

  // Helpers
  function createTeamCard(teamName) {
    const card = document.createElement("div");
    card.className = "team-card";
    card.textContent = teamName;
    return card;
  }

  function populateStage1() {
    Object.entries(divisions).forEach(([divisionName, teams]) => {
      const divisionGroup = [...document.querySelectorAll(".division-group")]
        .find(dg => dg.querySelector(".division-title").textContent === divisionName);
      const list = divisionGroup.querySelector(".team-list");
      list.innerHTML = "";
      teams.forEach(team => {
        const card = createTeamCard(team);
        card.addEventListener("click", () => {
          if (divisionWinners[divisionName] === team) {
            delete divisionWinners[divisionName];
            card.classList.remove("selected");
          } else {
            divisionWinners[divisionName] = team;
            Array.from(list.children).forEach(c => c.classList.remove("selected"));
            card.classList.add("selected");
          }
          updateToStage2Btn();
        });
        list.appendChild(card);
      });
    });
  }

  function updateToStage2Btn() {
    const allSelected = Object.keys(divisions).every(div => divisionWinners.hasOwnProperty(div));
    toStage2Btn.disabled = !allSelected;
  }

  toStage2Btn.addEventListener("click", () => {
    stage1.style.display = "none";
    stage2.style.display = "block";
    populateStage2();
  });

  function populateStage2() {
    wildcardList.innerHTML = "";
    const divisionWinnerSet = new Set(Object.values(divisionWinners));
    const allTeams = Object.values(divisions).flat();
    const remainingTeams = allTeams.filter(t => !divisionWinnerSet.has(t));
    remainingTeams.forEach(team => {
      const card = createTeamCard(team);
      card.addEventListener("click", () => {
        if (card.classList.contains("selected")) {
          card.classList.remove("selected");
          wildcardTeams = wildcardTeams.filter(t => t !== team);
        } else {
          if (wildcardTeams.length < 5) {
            card.classList.add("selected");
            wildcardTeams.push(team);
          } else {
            alert("You can only select 5 wildcard teams.");
            return;
          }
        }
        updateToStage3Btn();
      });
      wildcardList.appendChild(card);
    });
    wildcardTeams = [];
    updateToStage3Btn();
  }

  function updateToStage3Btn() {
    toStage3Btn.disabled = wildcardTeams.length !== 5;
  }

  toStage3Btn.addEventListener("click", () => {
    stage2.style.display = "none";
    stage3.style.display = "block";
    setupBracket();
  });

  // Create matchup UI block with clickable teams
  function createMatchup(id, teams, onPick) {
    const container = document.createElement("div");
    container.className = "round";
    container.id = id;

    const titleMap = {
      "qf1": "Quarterfinal 1",
      "qf2": "Quarterfinal 2",
      "qf3": "Quarterfinal 3",
      "qf4": "Quarterfinal 4",
      "sf1": "Semifinal 1",
      "sf2": "Semifinal 2",
      "final": "Final"
    };

    const title = document.createElement("h3");
    title.textContent = titleMap[id] || id;
    container.appendChild(title);

    teams.forEach(team => {
      const tOption = document.createElement("div");
      tOption.className = "team";
      tOption.textContent = team;
      tOption.addEventListener("click", () => {
        const siblings = container.querySelectorAll(".team");
        siblings.forEach(s => s.classList.remove("selected"));
        tOption.classList.add("selected");
        onPick(team);
      });
      container.appendChild(tOption);
    });

    return container;
  }

  function setupBracket() {
    quarterfinalsDiv.innerHTML = "";
    semifinalsDiv.innerHTML = "";
    finalDiv.innerHTML = "";
    championDiv.style.display = "none";
    championDiv.textContent = "";
    generateBracketBtn.style.display = "none";

    const dwSorted = Object.values(divisionWinners).sort();
    const wSorted = wildcardTeams.slice().sort();

    const qfMatchups = [
      [dwSorted[0], wSorted[0]],
      [dwSorted[1], wSorted[1]],
      [dwSorted[2], wSorted[2]],
      [wSorted[3], wSorted[4]],
    ];

    quarterFinalWinners = [null, null, null, null];
    semiFinalWinners = [null, null];
    finalWinner = null;

    qfMatchups.forEach((teams, idx) => {
      const id = "qf" + (idx + 1);
      const matchupDiv = createMatchup(id, teams, (winner) => {
        quarterFinalWinners[idx] = winner;
        updateSemifinals();
      });
      quarterfinalsDiv.appendChild(matchupDiv);
    });

    semifinalsDiv.style.display = "none";
    finalDiv.style.display = "none";
  }

  function updateSemifinals() {
    if (quarterFinalWinners.includes(null)) {
      semifinalsDiv.style.display = "none";
      finalDiv.style.display = "none";
      championDiv.style.display = "none";
      generateBracketBtn.style.display = "none";
      return;
    }

    semifinalsDiv.style.display = "flex";
    semifinalsDiv.innerHTML = "";

    const semifinalMatchups = [
      [quarterFinalWinners[0], quarterFinalWinners[1]],
      [quarterFinalWinners[2], quarterFinalWinners[3]]
    ];

    semiFinalWinners = [null, null];

    semifinalMatchups.forEach((teams, idx) => {
      const id = "sf" + (idx + 1);
      const matchupDiv = createMatchup(id, teams, (winner) => {
        semiFinalWinners[idx] = winner;
        updateFinal();
      });
      semifinalsDiv.appendChild(matchupDiv);
    });

    finalDiv.style.display = "none";
    championDiv.style.display = "none";
    generateBracketBtn.style.display = "none";
  }

  function updateFinal() {
    if (semiFinalWinners.includes(null)) {
      finalDiv.style.display = "none";
      championDiv.style.display = "none";
      generateBracketBtn.style.display = "none";
      return;
    }

    finalDiv.style.display = "flex";
    finalDiv.innerHTML = "";

    const matchupDiv = createMatchup("final", semiFinalWinners, (winner) => {
      finalWinner = winner;
      showChampion();
    });
    finalDiv.appendChild(matchupDiv);

    championDiv.style.display = "none";
    generateBracketBtn.style.display = "none";
  }

  function showChampion() {
    if (!finalWinner) return;
    championDiv.textContent = `Champion: ${finalWinner}`;
    championDiv.style.display = "block";
    generateBracketBtn.style.display = "inline-block";
  }

  // Generate static bracket page and open in new tab, fully scaled to fit iPhone 14 width & height
  generateBracketBtn.addEventListener("click", () => {
    if (!finalWinner) {
      alert("Please select the champion first!");
      return;
    }

    const dwSorted = Object.values(divisionWinners).sort();
    const wSorted = wildcardTeams.slice().sort();

    const qfMatchups = [
      [dwSorted[0], wSorted[0]],
      [dwSorted[1], wSorted[1]],
      [dwSorted[2], wSorted[2]],
      [wSorted[3], wSorted[4]],
    ];

    // Prepare semifinal and final winners from current selections:
    // We know quarterFinalWinners, semiFinalWinners, and finalWinner from current selections
    // To show the bracket fully "filled", use the winners from picks if available, else show teams normally

    // Helper function to create rounds html:
    function roundHTML(title, matchups, winners = []) {
      return `
      <div class="round">
        <h2>${title}</h2>
        ${matchups.map((teams, i) => {
          const w = winners[i];
          return `
            <div class="team${teams[0] === w ? " selected" : ""}">${teams[0]}</div>
            <div class="team${teams[1] === w ? " selected" : ""}">${teams[1]}</div>
            <hr style="border-color:#00ffff66; margin:10px 0;">
          `;
        }).join("")}
      </div>`;
    }

    const staticHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>IFL Playoff Bracket</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
  html, body {
    margin: 0; padding: 10px;
    background: #121212;
    color: #eee;
    font-family: 'Orbitron', sans-serif;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
  }
  h1 {
    color: #00ffff;
    text-shadow: 0 0 12px #00ffff;
    margin-bottom: 10px;
    font-size: 1.8rem;
    text-align: center;
  }
  .bracket-container {
    display: flex;
    flex-wrap: nowrap;
    justify-content: center;
    align-items: flex-start;
    gap: 15px;
    height: calc(100vh - 70px);
    transform-origin: top left;
  }
  .round {
    background: #222;
    border-radius: 10px;
    padding: 8px;
    min-width: 160px;
    box-shadow: 0 0 15px #00ffff;
    flex-shrink: 0;
    height: 100%;
    overflow-y: auto;
  }
  .round h2 {
    text-align: center;
    color: #00ffff;
    margin-bottom: 12px;
    font-size: 1.2rem;
  }
  .team {
    background: #111;
    margin: 5px 0;
    padding: 6px;
    border-radius: 6px;
    text-align: center;
    font-weight: 700;
    font-size: 1rem;
    border: 2px solid transparent;
    white-space: nowrap;
  }
  .team.selected {
    border-color: #00ffff;
    background: #004d4d;
    color: #00ffff;
  }
  .champion {
    margin-top: 15px;
    font-size: 1.4rem;
    font-weight: 900;
    color: #00ffcc;
    text-align: center;
    text-shadow: 0 0 15px #00ffcc;
  }
</style>
</head>
<body>
<h1>IFL Playoff Bracket</h1>
<div class="bracket-container">
  ${roundHTML("Quarterfinals", qfMatchups, quarterFinalWinners)}
  ${roundHTML("Semifinals", [
    [quarterFinalWinners[0], quarterFinalWinners[1]],
    [quarterFinalWinners[2], quarterFinalWinners[3]]
  ], semiFinalWinners)}
  <div class="round">
    <h2>Final</h2>
    <div class="team selected">${finalWinner}</div>
  </div>
</div>
<div class="champion">Champion: ${finalWinner}</div>
<script>
  // Scale bracket to fit iPhone 14 viewport width and height without scroll
  function scale() {
    const container = document.querySelector('.bracket-container');
    const vw = window.innerWidth;
    const vh = window.innerHeight - 80;
    const rect = container.getBoundingClientRect();

    const scaleX = vw / rect.width;
    const scaleY = vh / rect.height;
    const scaleFactor = Math.min(scaleX, scaleY, 1);

    container.style.transform = 'scale(' + scaleFactor + ')';
  }
  window.addEventListener('resize', scale);
  window.addEventListener('load', scale);
</script>
</body>
</html>
`;

    const blob = new Blob([staticHTML], { type: "text/html" });
    const url = URL.createObjectURL(blob);
    window.open(url, "_blank");
  });

  // Initialize
  populateStage1();

</script>

</body>
</html>
