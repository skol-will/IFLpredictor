<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IFL Playoff Predictor with Working Bracket</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet" />
  <style>
    /* Common styling for all stages */
    body {
      margin: 0; padding: 0;
      font-family: 'Orbitron', sans-serif;
      background: #121212;
      color: white;
      overflow-x: auto;
    }
    button {
      margin: 10px 0;
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background-color: #00BFFF;
      color: black;
      font-weight: bold;
    }
    button:disabled {
      background-color: #555;
      cursor: not-allowed;
      color: #ccc;
    }
    .hidden { display: none; }

    /* Stage containers */
    #stage1, #stage2, #stage3 {
      padding: 20px;
    }

    /* Division winner cards (Stage 1) */
    .division-container {
      margin-bottom: 24px;
    }
    .division-container h2 {
      text-transform: uppercase;
      font-size: 1.2rem;
      margin-bottom: 8px;
    }
    .team-card {
      display: inline-block;
      width: 140px;
      height: 40px;
      border-radius: 8px;
      overflow: hidden;
      margin: 6px 8px 6px 0;
      cursor: pointer;
      position: relative;
      box-shadow: 0 0 6px rgba(0,0,0,0.7);
      transition: transform 0.15s ease, outline 0.2s ease;
    }
    .team-card img {
      position: absolute;
      top: 0; left: 0;
      width: 140px;
      height: 40px;
      object-fit: cover;
      z-index: 1;
    }
    .team-card span {
      position: absolute;
      z-index: 2;
      width: 100%;
      height: 100%;
      font-size: 0.9rem;
      color: #fff;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      text-shadow: 0 0 3px #000;
      background: rgba(0,0,0,0.3);
    }
    .team-card.selected {
      outline: 3px solid #00BFFF;
      transform: scale(1.05);
    }

    /* Wildcard list (Stage 2) */
    #wildcard-list {
      max-width: 1000px;
      margin-bottom: 20px;
    }
    #wildcard-list .team-card {
      margin: 6px 8px 6px 0;
    }

    /* Bracket styles (Stage 3) */
    .bracket-container {
      max-width: 1024px;
      margin: 0 auto;
    }
    .bracket-header {
      display: flex;
      margin-bottom: 12px;
      justify-content: space-between;
      max-width: 600px;
    }
    .bracket-header > div {
      width: 184px;
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      user-select: none;
    }
    .brackets {
      display: flex;
      position: relative;
      max-width: 600px;
    }
    .round {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-right: 40px;
      position: relative;
    }
    .matchup {
      margin: 30px 0;
      position: relative;
    }
    .team-card.bracket {
      width: 144px;
      height: 40px;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      margin: 5px 0;
      position: relative;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.5);
      transition: transform 0.2s, outline 0.2s;
    }
    .team-card.bracket img {
      position: absolute;
      top: 0; left: 0;
      width: 144px;
      height: 40px;
      object-fit: cover;
      z-index: 1;
    }
    .team-card.bracket span {
      position: absolute;
      z-index: 2;
      width: 100%;
      height: 100%;
      font-size: 0.9rem;
      color: #fff;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      text-shadow: 0 0 4px #000;
      background: rgba(0,0,0,0.3);
    }
    .team-card.bracket.selected {
      outline: 3px solid #00BFFF;
      transform: scale(1.05);
    }

    .champion-section {
      margin-top: 40px;
      text-align: center;
      width: 100%;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .champion-card {
      width: 144px;
      height: 40px;
      border-radius: 8px;
      overflow: hidden;
      margin: 0 auto;
      position: relative;
      box-shadow: 0 0 8px gold;
    }
    .champion-card img {
      position: absolute;
      width: 144px;
      height: 40px;
      object-fit: cover;
      top: 0;
      left: 0;
      z-index: 1;
    }
    .champion-card span {
      position: absolute;
      z-index: 2;
      width: 100%;
      height: 100%;
      font-size: 0.95rem;
      font-weight: bold;
      color: black;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 215, 0, 0.6);
      text-shadow: 0 0 3px #fff;
    }
  </style>
</head>
<body>
  <!-- Stage 1: Division Winners -->
  <div id="stage1">
    <h1>Select Division Winners</h1>

    <div class="division-container" data-division="world-east">
      <h2>World East</h2>
    </div>

    <div class="division-container" data-division="world-central">
      <h2>World Central</h2>
    </div>

    <div class="division-container" data-division="world-west">
      <h2>World West</h2>
    </div>

    <button id="toStage2" disabled>Next: Select Wildcards</button>
  </div>

  <!-- Stage 2: Wildcards -->
  <div id="stage2" class="hidden">
    <h1>Select 5 Wildcard Teams</h1>
    <div id="wildcard-list"></div>
    <button id="backTo1">Back to Division Winners</button>
    <button id="toStage3" disabled>Next: View Bracket</button>
  </div>

  <!-- Stage 3: Bracket -->
  <div id="stage3" class="hidden">
    <h1>Playoff Bracket</h1>
    <div class="bracket-container">
      <div class="bracket-header">
        <div>Divisional</div>
        <div>Conference</div>
        <div>Championship</div>
      </div>

      <div class="brackets">
        <div class="round" id="divisional"></div>
        <div class="round" id="conference"></div>
        <div class="round" id="championship"></div>
      </div>

      <div class="champion-section">
        <h2>üèÜ Champion üèÜ</h2>
        <div id="champion" class="champion-card"><span>?</span></div>
      </div>
    </div>

    <button id="backTo2">Back to Wildcards</button>
  </div>

  <script>
    // All teams data for Stage 1 and 2
    const allTeams = [
      // World East
      { division: 'world-east', name: 'Australia Whites', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182184/australia-whites_h9o2vz.png' },
      { division: 'world-east', name: 'Italia Bulls', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/italia-bulls_aocvis.png' },
      { division: 'world-east', name: 'Japan Samurai', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/japan-samurai_jgrkm1.png' },
      { division: 'world-east', name: 'South Korea Deers', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/southkorea-deers_jbt02f.png' },
      { division: 'world-east', name: 'Poland Panthers', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/poland-panthers_ppg3zr.png' },

      // World Central
      { division: 'world-central', name: 'Germany Cavaliers', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/germany-cavaliers_qrcojc.png' },
      { division: 'world-central', name: 'UK 3 Lions', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/uk-tri-lions_kyixfr.png' },
      { division: 'world-central', name: 'Finland Frigate', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/finland-frigate_u7rjbj.png' },
      { division: 'world-central', name: 'Belgium Bulldogs', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/belgium-bulldogs_hrx8td.png' },
      { division: 'world-central', name: 'Holland Hornets', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/holland-hornets_ilzroo.png' },
      { division: 'world-central', name: 'South Africa Silverbacks', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/southafrica-silverbaks_x6but2.png' },

      // World West
      { division: 'world-west', name: 'USA Drones', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182187/usa-drones_doeba8.png' },
      { division: 'world-west', name: 'Jamaica Thunder', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/jamaica-thunder_ogo7aj.png' },
      { division: 'world-west', name: 'Rwanda Raiders', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/rwanda-raiders_aqtgu7.png' },
      { division: 'world-west', name: 'Egypt Pharaohs', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/egypt-pharaohs_ycglpl.png' },
      { division: 'world-west', name: 'Peru Piranhas', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/peru-piranhas_yueas6.png' },
      { division: 'world-west', name: 'Brazil Hummingbirds', logo: 'https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/brazil-hummingbirds_dras9r.png' }
    ];

    // Stage 1 variables
    const stage1 = document.getElementById('stage1');
    const divisionContainers = document.querySelectorAll('.division-container');
    const toStage2Btn = document.getElementById('toStage2');

    // Track selected winners per division
    const selectedDivisionWinners = {
      'world-east': null,
      'world-central': null,
      'world-west': null
    };

    // Render teams per division for Stage 1
    divisionContainers.forEach(container => {
      const division = container.dataset.division;
      const teams = allTeams.filter(t => t.division === division);
      teams.forEach(team => {
        const card = document.createElement('div');
        card.className = 'team-card';
        card.tabIndex = 0;
        card.dataset.team = team.name;
        card.innerHTML = `<img src="${team.logo}" alt="${team.name}"><span>${team.name}</span>`;
        container.appendChild(card);

        card.addEventListener('click', () => {
          if (selectedDivisionWinners[division]) {
            selectedDivisionWinners[division].classList.remove('selected');
          }
          selectedDivisionWinners[division] = card;
          card.classList.add('selected');
          checkStage1Complete();
        });
        card.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            card.click();
          }
        });
      });
    });

    function checkStage1Complete() {
      const allSelected = Object.values(selectedDivisionWinners).every(v => v !== null);
      toStage2Btn.disabled = !allSelected;
    }

    // Stage 2 variables
    const stage2 = document.getElementById('stage2');
    const wildcardList = document.getElementById('wildcard-list');
    const toStage3Btn = document.getElementById('toStage3');
    const backTo1Btn = document.getElementById('backTo1');

    let selectedWildcards = [];
    const maxWildcards = 5;

    function populateWildcards() {
      wildcardList.innerHTML = '';
      selectedWildcards = [];

      const winners = Object.values(selectedDivisionWinners).map(card => card.dataset.team);

      const wildcardCandidates = allTeams.filter(t => !winners.includes(t.name));

      wildcardCandidates.forEach(team => {
        const card = document.createElement('div');
        card.className = 'team-card';
        card.tabIndex = 0;
        card.dataset.team = team.name;
        card.innerHTML = `<img src="${team.logo}" alt="${team.name}"><span>${team.name}</span>`;
        wildcardList.appendChild(card);

        card.addEventListener('click', () => {
          if (card.classList.contains('selected')) {
            card.classList.remove('selected');
            selectedWildcards = selectedWildcards.filter(t => t !== team.name);
          } else {
            if (selectedWildcards.length < maxWildcards) {
              card.classList.add('selected');
              selectedWildcards.push(team.name);
            }
          }
          toStage3Btn.disabled = (selectedWildcards.length !== maxWildcards);
        });

        card.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            card.click();
          }
        });
      });

      toStage3Btn.disabled = true;
    }

    toStage2Btn.addEventListener('click', () => {
      stage1.classList.add('hidden');
      stage2.classList.remove('hidden');
      populateWildcards();
    });

    backTo1Btn.addEventListener('click', () => {
      stage2.classList.add('hidden');
      stage1.classList.remove('hidden');
    });

    // Stage 3 variables
    const stage3 = document.getElementById('stage3');
    const backTo2Btn = document.getElementById('backTo2');
    const divisionalContainer = document.getElementById('divisional');
    const conferenceContainer = document.getElementById('conference');
    const championshipContainer = document.getElementById('championship');
    const championCard = document.getElementById('champion');

    // Bracket data store
    const bracketData = {
      divisional: [],
      conference: [],
      championship: []
    };

    backTo2Btn.addEventListener('click', () => {
      stage3.classList.add('hidden');
      stage2.classList.remove('hidden');
      // Clear bracket so they can redo selections
      divisionalContainer.innerHTML = '';
      conferenceContainer.innerHTML = '';
      championshipContainer.innerHTML = '';
      championCard.innerHTML = '<span>?</span>';
    });

    toStage3Btn.addEventListener('click', () => {
      stage2.classList.add('hidden');
      stage3.classList.remove('hidden');

      // Build playoff teams from selected winners and wildcards
      const divisionWinnersTeams = Object.values(selectedDivisionWinners).map(card => {
        const name = card.dataset.team;
        const teamData = allTeams.find(t => t.name === name);
        return teamData;
      });
      const wildcardTeams = selectedWildcards.map(name => allTeams.find(t => t.name === name));

      // Combine and render divisional round
      const playoffTeams = [...divisionWinnersTeams, ...wildcardTeams];

      // Reset bracket data
      bracketData.divisional = new Array(playoffTeams.length / 2).fill(null);
      bracketData.conference = [];
      bracketData.championship = [];
      championCard.innerHTML = '<span>?</span>';

      renderRound('divisional', playoffTeams);
      conferenceContainer.innerHTML = '';
      championshipContainer.innerHTML = '';
    });

    // ========== BRACKET CODE YOU PROVIDED BELOW ==========

    function createMatchup(team1, team2, matchIndex, roundId) {
      const matchup = document.createElement('div');
      matchup.className = 'matchup';
      matchup.dataset.match = matchIndex;

      function createCard(team) {
        const card = document.createElement('div');
        card.className = 'team-card bracket';

        if (team) {
          card.dataset.name = team.name;
          card.innerHTML = `
            <img src="${team.logo}" alt="${team.name} logo">
            <span>${team.name}</span>
          `;
          card.onclick = () => selectTeam(card, matchIndex, roundId);
        } else {
          card.innerHTML = `<span>TBD</span>`;
          card.style.opacity = 0.5;
          card.style.cursor = 'default';
        }

        return card;
      }

      matchup.appendChild(createCard(team1));
      matchup.appendChild(createCard(team2));
      return matchup;
    }

    function renderRound(roundId, teams) {
      const container = document.getElementById(roundId);
      container.innerHTML = "";
      bracketData[roundId] = new Array(teams.length / 2).fill(null);

      for (let i = 0; i < teams.length; i += 2) {
        const matchup = createMatchup(teams[i], teams[i + 1], i / 2, roundId);
        container.appendChild(matchup);
      }
    }

    function selectTeam(el, matchIndex, roundId) {
      const container = document.getElementById(roundId);
      const matchup = container.querySelector(`.matchup[data-match="${matchIndex}"]`);
      Array.from(matchup.children).forEach(card => card.classList.remove('selected'));
      el.classList.add('selected');

      bracketData[roundId][matchIndex] = {
        name: el.dataset.name,
        logo: el.querySelector('img')?.src || ""
      };

      const isComplete = bracketData[roundId].every(x => x !== null);

      if (isComplete) {
        if (roundId === 'divisional') {
          createNextRound('conference', bracketData.divisional);
        } else if (roundId === 'conference') {
          createNextRound('championship', bracketData.conference);
        } else if (roundId === 'championship') {
          const champion = bracketData.championship[0];
          if (champion) {
            championCard.innerHTML = `
              <img src="${champion.logo}" alt="${champion.name} logo">
              <span>${champion.name}</span>
            `;
          }
        }
      }
    }

    function createNextRound(nextRoundId, previousWinners) {
      const container = document.getElementById(nextRoundId);
      container.innerHTML = "";
      bracketData[nextRoundId] = [];

      for (let i = 0; i < previousWinners.length; i += 2) {
        const team1 = previousWinners[i];
        const team2 = previousWinners[i + 1] || null;
        const matchup = createMatchup(team1, team2, i / 2, nextRoundId);
        container.appendChild(matchup);
        bracketData[nextRoundId].push(null);
      }
    }
  </script>
</body>
</html>
